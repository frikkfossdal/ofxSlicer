# ofxSlicer

Slices mesh geometry into layers consisting of curves. Written in c++ as an addon for Openframeworks. Currently missing any form of infill strategy and .gcode generation. 

![current](docs/img/currentOverview.png)

## Some background

I wanted to build my own slicer to control the generation of toolpaths for my various machines. I wanted the slicer to be really lightweight and fast. I came across a [paper](http://www.dainf.ct.utfpr.edu.br/~rminetto/projects/slicing/) some time a go where they claimed to have implemented a slicing algorithm that is faster than many of the existing slicers like Sli3er and Cura. 

### Philosophy 

If you want to learn more about the project and the movitation behind it, I have included much more information about this in another repo [here](https://github.com/frikkfossdal/fluffy-octo-potato).  Just to give some quick context, the main objective is to distribute the toolpaths generated by the slicer between multiple extruders working in parallell. 

### Structure

Stucturing of the information is key when working with the amount of data that a high-dense .stl-file will give you. The ofxSlicer mainly structures the data into objects of the Layer-class. The contours located by the slicing-algorithm is distributed into the Layer-class  sub-class Jobs. A job is defined as a contour that needs to be executed in the printer. I realize that this gets more and more messier as I write about it, so look to the figure below to get a general idea of the structure. 

![structure](docs/img/philosophy.png)

## The Slicer

The slicing algorithm goes something like this:

1. Create a list containing all triangles of the mesh model.
2. Mesh slicing:  Calculate triangle intersection points on each plane.
3. Construct contours: Create polygons from the intersection points for each plane.
4. Make sence of the polygons (Clockwice/Counterclockwise)

Full disclaimer. I´m new to C++, and by no means an expert in programming. I wanted to keep close track on how the memory is used and allocated by the slicer. Based on this I decided that C++ would be an optimal choise of language.  I´m also having a really alright time with Openframeworks. 

### Getting the triangles 

Getting the triangles was a bit of a struggle in Openframeworks. To import .stl files, I use the [ofxAssimpModelLoader](http://openframeworks.cc/documentation/ofxAssimpModelLoader/ofxAssimpModelLoader/) addon in openframeworks.  It took some tweaking to get the triangle faces, with it´s belonging vertices extracted from the assimp class. All the triangles are sorted in ascending order in terms of the lowest point in the triangle. I have commented this in the code. NOTE: It would probaly be easier to use some kind of existing C++ framework for geometry like CGAL

### Calculate the triangle intersections 

Once we have the triangles it´s time to calculate the intersection points on each layer. Have a look at this figure. 

![triangleInter](docs/img/triangle_slicing-01.png)

I basically have three diferent situations. 
1. The triangle is located on the topside of the layer plane 
2. The triangle is intersecting with the plane. 
3. The triangle is underneath the plane. This means that the slicer is finished processing it. 


### Active triangles 

To improve the speed of the algorithm the triangles that are finished processed are removed from the triangle list that is used in the calculation. This condition applies when the entire triangle is located underneath the layer plane. See figure. 

![active triangles](docs/img/triangle_slicing-02.png)


### Creating the jobs // Contour Construction 

Once the triangle intersection algorithm has swept trough all of the triangles I basically have a bunch of layers containing intersection points relevant to that layer.  From this, I want to create sets of polygons, or contours, that essentially is the jobs that need to be performed on each layer. Ive illustrated the problem in the figure below. 

TODO: add figure of problem

So solve the problem I define a hash table where each point in the contour is defined as the index key of the table and the neighboor points is the keys belonging values, like so: 

TODO: insert example of hash table 

TODO: Insert figure here. 

### Adding infill lines 

### Threading in C++

### How you can use it
Reusing the slicer in your Openframeworks project should be pretty straightforward. 
* clone the git into your local addons folder
* use the Openframeworks projectGenerator to include the ofxSlicer in your project 
* create an ofxSlicer object, feed it an stl and start slicing. Do a debug if your want to study how the data is structured. 

##
